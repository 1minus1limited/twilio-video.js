<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: participant.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: participant.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&apos;use strict&apos;;

var DefaultAudioTrack = require(&apos;./media/track/audiotrack&apos;);
var DefaultVideoTrack = require(&apos;./media/track/videotrack&apos;);
var EventEmitter = require(&apos;events&apos;).EventEmitter;
var inherits = require(&apos;util&apos;).inherits;
var Media = require(&apos;./media&apos;);

/**
 * Construct a {@link Participant}.
 * @class
 * @classdesc A {@link Participant} represents a remote {@link Client} in a
 * {@link Room}.
 * @param {ParticipantSignaling} signaling
 * @param {Media} [media]
 * @param {object} [options]
 * @property {Participant.Identity} identity - The identity of the {@link Participant}
 * @property {Media} media - The {@link Media} this {@link Participant} is sharing, if any
 * @property {Participant.SID} sid - The {@link Participant}&apos;s SID
 * @property {string} state - &quot;connected&quot;, &quot;disconnected&quot; or &quot;failed&quot;
 * @fires Participant#connected
 * @fires Participant#disconnected
 * @fires Participant#trackAdded
 * @fires Participant#trackDimensionsChanged
 * @fires Participant#trackDisabled
 * @fires Participant#trackEnabled
 * @fires Participant#trackEnded
 * @fires Participant#trackRemoved
 * @fires Participant#trackStarted
 */
function Participant(signaling, media, options) {
  if (!(this instanceof Participant)) {
    return new Participant(signaling, media, options);
  }
  EventEmitter.call(this);

  options = Object.assign({
    AudioTrack: DefaultAudioTrack,
    VideoTrack: DefaultVideoTrack
  }, options);

  Object.defineProperties(this, {
    _AudioTrack: {
      value: options.AudioTrack
    },
    _signaling: {
      value: signaling
    },
    _VideoTrack: {
      value: options.VideoTrack
    },
    identity: {
      enumerable: true,
      value: signaling.identity
    },
    media: {
      enumerable: true,
      value: media || new Media()
    },
    sid: {
      enumerable: true,
      value: signaling.sid
    },
    state: {
      enumerable: true,
      get: function() {
        return signaling.state;
      }
    }
  });

  handleMediaAndSignalingEvents(this, signaling);
  this._handleTrackSignalingEvents();
}

inherits(Participant, EventEmitter);

Participant.prototype._handleTrackSignalingEvents = function _handleTrackSignalingEvents() {
  if (this.state === &apos;disconnected&apos;) {
    return;
  }

  var AudioTrack = this._AudioTrack;
  var media = this.media;
  var signaling = this._signaling;
  var VideoTrack = this._VideoTrack;

  function trackSignalingAdded(signaling) {
    signaling.getMediaStreamTrack().then(function(pair) {
      var mediaStreamTrack = pair[0];
      var mediaStream = pair[1];
      var Track = signaling.kind === &apos;audio&apos; ? AudioTrack : VideoTrack;
      var track = new Track(mediaStream, mediaStreamTrack, signaling);
      media._addTrack(track);
    });
  }

  function trackSignalingRemoved(signaling) {
    signaling.getMediaStreamTrack().then(function() {
      var track = media.tracks.get(signaling.id);
      if (track) {
        media._removeTrack(track);
      }
    });
  }

  signaling.on(&apos;trackAdded&apos;, trackSignalingAdded);
  signaling.on(&apos;trackRemoved&apos;, trackSignalingRemoved);

  signaling.tracks.forEach(trackSignalingAdded);

  signaling.on(&apos;stateChanged&apos;, function stateChanged(state) {
    if (state === &apos;disconnected&apos;) {
      signaling.removeListener(&apos;stateChanged&apos;, stateChanged);
      signaling.removeListener(&apos;trackAdded&apos;, trackSignalingAdded);
      signaling.removeListener(&apos;trackRemoved&apos;, trackSignalingRemoved);
    }
  });
};

/**
 * A {@link Participant.SID} is a 34-character string starting with &quot;PA&quot;
 * that uniquely identifies a {@link Participant}.
 * @type string
 * @typedef Participant.SID
 */

/**
 * A {@link Participant.Identity} is a string that identifies a
 * {@link Participant}. You can think of it like a name.
 * @type string
 * @typedef Participant.Identity
 */

/**
 * The {@link Participant} has disconnected.
 * @param {Participant} participant - The {@link Participant} that disconnected.
 * @event Participant#disconnected
 */

/**
 * A {@link Track} was added by the {@link Participant}.
 * @param {Track} track - The {@link Track} that was added
 * @event Participant#trackAdded
 */

/**
 * One of the {@link Participant}&apos;s {@link VideoTrack}&apos;s dimensions changed.
 * @param {VideoTrack} track - The {@link VideoTrack} whose dimensions changed
 * @event Participant#trackDimensionsChanged
 */

/**
 * A {@link Track} was disabled by the {@link Participant}.
 * @param {Track} track - The {@link Track} that was disabled
 * @event Participant#trackDisabled
 */

/**
 * A {@link Track} was enabled by the {@link Participant}.
 * @param {Track} track - The {@link Track} that was enabled
 * @event Participant#trackEnabled
 */

/**
 * One of the {@link Participant}&apos;s {@link Track}s ended.
 * @param {Track} track - The {@link Track} that ended
 * @event Participant#trackEnded
 */

/**
 * A {@link Track} was removed by the {@link Participant}.
 * @param {Track} track - The {@link Track} that was removed
 * @event Participant#trackRemoved
 */

/**
 * One of the {@link Participant}&apos;s {@link Track}s started.
 * @param {Track} track - The {@link Track} that started
 * @event Participant#trackStarted
 */

function handleMediaAndSignalingEvents(participant, signaling) {
  if (participant.state === &apos;disconnected&apos;) {
    return;
  }

  // Reemit Track events from Media.
  var removeListeners = [
    &apos;trackAdded&apos;,
    &apos;trackDimensionsChanged&apos;,
    &apos;trackDisabled&apos;,
    &apos;trackEnabled&apos;,
    &apos;trackEnded&apos;,
    &apos;trackRemoved&apos;,
    &apos;trackStarted&apos;
  ].map(function(event) {
    function eventListener() {
      var args = [].slice.call(arguments);
      args.unshift(event);
      participant.emit.apply(participant, args);
    }
    participant.media.on(event, eventListener);
    return participant.media.removeListener.bind(participant.media, event, eventListener);
  });

  // Reemit state transition events from the ParticipantSignaling.
  signaling.on(&apos;stateChanged&apos;, function stateChanged(state) {
    participant.emit(state, participant);
    if (state === &apos;disconnected&apos;) {
      signaling.removeListener(&apos;stateChanged&apos;, stateChanged);
      removeListeners.forEach(function(removeListener) {
        removeListener();
      });
    }
  });
}

module.exports = Participant;
</code></pre>
        </article>
    </section>




</div>

<nav><h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AudioTrack.html">AudioTrack</a></li><li><a href="Client.html">Client</a></li><li><a href="LocalAudioTrack.html">LocalAudioTrack</a></li><li><a href="LocalMedia.html">LocalMedia</a></li><li><a href="LocalParticipant.html">LocalParticipant</a></li><li><a href="LocalTrack.html">LocalTrack</a></li><li><a href="LocalVideoTrack.html">LocalVideoTrack</a></li><li><a href="Media.html">Media</a></li><li><a href="Participant.html">Participant</a></li><li><a href="Room.html">Room</a></li><li><a href="Track.html">Track</a></li><li><a href="VideoTrack.html">VideoTrack</a></li></ul></nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0-dev</a> on Tue Aug 23 2016 16:34:30 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-2900316-33', 'auto');ga('send', 'pageview');</script></body>
</html>
