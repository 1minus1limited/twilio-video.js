<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: media/track/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: media/track/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&apos;use strict&apos;;

var EventEmitter = require(&apos;events&apos;).EventEmitter;
var inherits = require(&apos;util&apos;).inherits;

/**
 * Construct a {@link Track} from a MediaStream and MediaStreamTrack.
 * @class
 * @classdesc A {@link Track} represents audio or video that can be sent to or
 * received from a {@link Conversation}. {@link Track}s abstract away the notion
 * of MediaStream and MediaStreamTrack.
 * @param {MediaStream} mediaStream
 * @param {MediaStreamTrack} mediaStreamTrack
 * @property {string} id - This {@link Track}&apos;s ID
 * @property {boolean} isEnded - Whether or not the {@link Track} has ended
 * @property {boolean} isStarted - Whether or not the {@link Track} has started
 * @property {string} label - This {@link Track}&apos;s label; e.g. &quot;microphone&quot;,
 *   &quot;camera&quot;
 * @property {string} kind - The kind of the underlying
 *   {@link MediaStreamTrack}; e.g. &quot;audio&quot; or &quot;video&quot;
 * @property {MediaStream} mediaStream - The underlying MediaStream
 * @property {MediaStreamTrack} mediaStreamTrack - The underlying
 *   MediaStreamTrack
 * @fires Track#disabled
 * @fires Track#enabled
 * @fires Track#ended
 * @fires Track#started
 */
function Track(mediaStream, mediaStreamTrack) {
  EventEmitter.call(this);
  var isEnabled = true;
  var isEnded = false;
  var isStarted = false;
  /* istanbul ignore next */
  Object.defineProperties(this, {
    _isEnabled: {
      get: function() {
        return isEnabled;
      },
      set: function(_isEnabled) {
        isEnabled = _isEnabled;
      }
    },
    _isEnded: {
      get: function() {
        return isEnded;
      },
      set: function(_isEnded) {
        isEnded = _isEnded;
      }
    },
    _isStarted: {
      get: function() {
        return isStarted;
      },
      set: function(_isStarted) {
        isStarted = _isStarted;
      }
    },
    attachments: {
      value: new Set()
    },
    id: {
      enumerable: true,
      value: mediaStreamTrack.id
    },
    isEnabled: {
      get: function() {
        return isEnabled;
      }
    },
    isEnded: {
      get: function() {
        return isEnded;
      }
    },
    isStarted: {
      get: function() {
        return isStarted;
      }
    },
    label: {
      enumerable: true,
      value: mediaStreamTrack.kind === &apos;audio&apos; ? &apos;microphone&apos; : &apos;camera&apos;
    },
    kind: {
      enumerable: true,
      value: mediaStreamTrack.kind
    },
    mediaStream: {
      enumerable: true,
      value: mediaStream
    },
    mediaStreamTrack: {
      enumerable: true,
      value: mediaStreamTrack
    }
  });
  var self = this;
  mediaStreamTrack.onended = function onended() {
    /* eslint no-use-before-define:0 */
    self.emit(ENDED, self);
  };
  emitStartedEvent(this);
}

var DISABLED = Track.DISABLED = &apos;disabled&apos;;
var ENABLED = Track.ENABLED = &apos;enabled&apos;;
var ENDED = Track.ENDED = &apos;ended&apos;;
var STARTED = Track.STARTED = &apos;started&apos;;

function emitStartedEvent(track) {
  if (typeof document === &apos;undefined&apos;) {
    throw new Error(&apos;document is undefined&apos;);
  }
  var elem = document.createElement(track.kind);
  elem.muted = true;
  elem.oncanplay = function oncanplay() {
    track.detach(elem);
    track._isStarted = true;
    if (track.kind === &apos;video&apos;) {
      track.dimensions.width = elem.videoWidth;
      track.dimensions.height = elem.videoHeight;
    }
    track.emit(STARTED, track);
    elem.oncanplay = null;
  };
  track.once(ENDED, function() {
    track.detach(elem);
    elem.oncanplay = null;
  });
  return track.attach(elem);
}

function attachAudio(audio, mediaStream) {
  if (typeof window !== &apos;undefined&apos; &amp;&amp; typeof navigator !== &apos;undefined&apos;) {
    if (typeof navigator.webkitGetUserMedia === &apos;function&apos;) {
      var vendorURL = window.URL || window.webkitURL;
      audio.src = vendorURL.createObjectURL(mediaStream);
    } else if (typeof navigator.mozGetUserMedia === &apos;function&apos;) {
      audio.mozSrcObject = mediaStream;
    }
    audio.play();
    return audio;
  }
  throw new Error(&apos;Cannot attach to &lt;audio&gt; element&apos;);
}

Track.attachAudio = attachAudio;

function attachVideo(video, mediaStream) {
  if (typeof window !== &apos;undefined&apos; &amp;&amp; typeof navigator !== &apos;undefined&apos;) {
    if (typeof navigator.webkitGetUserMedia === &apos;function&apos;) {
      var vendorURL = window.URL || window.webkitURL;
      video.src = vendorURL.createObjectURL(mediaStream);
    } else if (typeof navigator.mozGetUserMedia === &apos;function&apos;) {
      video.mozSrcObject = mediaStream;
    }
    video.muted = true;
    video.play();
    return video;
  }
  throw new Error(&apos;Cannot attach to &lt;video&gt; element&apos;);
}

Track.attachVideo = attachVideo;

inherits(Track, EventEmitter);

Track.prototype._enable = function _enable(enabled) {
  if (this._isEnabled !== enabled) {
    this._isEnabled = enabled;
    this.emit(enabled ? ENABLED : DISABLED, this);
  }
  return this;
};

Track.prototype.attach = function attach() {
  var args = [].slice.call(arguments);
  args.unshift(this);
  return attachAudioOrVideoTrack.apply(this, args);
};

Track.prototype.detach = function detach() {
  var args = [].slice.call(arguments);
  args.unshift(this);
  return detachAudioOrVideoTrack.apply(this, args);
};

/**
 * Disable the {@link Track}.
 * @returns {this}
 * @fires Track#disabled
 */
Track.prototype.disable = function disable() {
  return this.enable(false);
};

/**
 * Enable the {@link Track}.
 * @returns {this}
 * @fires Track#enabled
*//**
 * Enable or disable the {@link Track}.
 * @param {boolean} [enabled] - Specify false to disable the {@link Track}
 * @returns {this}
 * @fires Track#disabled
 * @fires Track#enabled
 */
Track.prototype.enable = function enable(enabled) {
  enabled = typeof enabled === &apos;boolean&apos; ? enabled : true;
  this.mediaStreamTrack.enabled = enabled;
  return this._enable(enabled);
};

/**
 * Stop sending this {@link Track}.
 * @returns {Track}
 * @fires Track#ended
 */
Track.prototype.stop = function stop() {
  this.mediaStreamTrack.stop();
  return this;
};

function attachAudioOrVideoTrack(track, el) {
  if (!el) {
    return createElementAndAttachAudioOrVideoTrack(track);
  } else if (typeof el === &apos;string&apos;) {
    return selectElementAndAttachAudioOrVideoTrack(track, el);
  }
  return attachAudioOrVideoTrackToElement(track, el);
}

function attachAudioOrVideoTrackToElement(track, el) {
  if (track.attachments.has(el)) {
    return el;
  }
  var attachMethod = track.kind === &apos;audio&apos; ? attachAudio : attachVideo;
  attachMethod(el, track.mediaStream);
  track.attachments.add(el);
  return el;
}

function selectElementAndAttachAudioOrVideoTrack(track, selector) {
  if (typeof document === &apos;undefined&apos;) {
    throw new Error(&apos;document is undefined&apos;);
  }
  var el = document.querySelector(selector);
  if (!el) {
    throw new Error(&apos;document.querySelector returned nothing&apos;);
  }
  return attachAudioOrVideoTrackToElement(track, el);
}

function createElementAndAttachAudioOrVideoTrack(track) {
  if (typeof document === &apos;undefined&apos;) {
    throw new Error(&apos;document is undefined&apos;);
  }
  var el = document.createElement(track.kind);
  return attachAudioOrVideoTrackToElement(track, el);
}

function detachAudioOrVideoTrack(track, el) {
  if (!el) {
    return detachAudioOrVideoTrackFromAllElements(track);
  } else if (typeof el === &apos;string&apos;) {
    return selectElementAndDetachAudioOrVideoTrack(track, el);
  }
  return detachAudioOrVideoTrackFromElement(track, el);
}

Track.detachAudioOrVideoTrack = detachAudioOrVideoTrack;

function detachAudioOrVideoTrackFromElement(track, el) {
  if (!track.attachments.has(el)) {
    return el;
  }
  el.removeAttribute(&apos;src&apos;);
  track.attachments.delete(el);
  return el;
}

function selectElementAndDetachAudioOrVideoTrack(track, selector) {
  if (typeof document === &apos;undefined&apos;) {
    throw new Error(&apos;document is undefined&apos;);
  }
  var el = document.querySelector(selector);
  if (!el) {
    throw new Error(&apos;document.querySelector returned nothing&apos;);
  }
  return detachAudioOrVideoTrackFromElement(track, el);
}

function detachAudioOrVideoTrackFromAllElements(track) {
  var els = [];
  track.attachments.forEach(function(el) {
    els.push(el);
    detachAudioOrVideoTrackFromElement(track, el);
  });
  return els;
}

/**
 * The {@link Track} was disabled. For {@link AudioTrack}s this means
 * &quot;muted&quot;, and for {@link VideoTrack}s this means &quot;paused&quot;.
 * @param {Track} track - The {@link Track} that was disabled
 * @event Track#disabled
 */

/**
 * The {@link Track} was enabled. For {@link AudioTrack}s this means
 * &quot;unmuted&quot;, and for {@link VideoTrack}s this means &quot;unpaused&quot;.
 * @param {Track} track - The {@link Track} that was enabled
 * @event Track#enabled
 */

/**
 * The {@link Track} ended. This means that the {@link Track} will no longer
 * playback audio or video.
 * @param {Track} track - The {@link Track} that ended
 * @event Track#ended
 */

/**
 * The {@link Track} started. This means that the {@link Track} contains
 * enough audio or video to begin playback.
 * @param {Track} track - The {@link Track} that started
 * @event Track#started
 */

module.exports = Track;
</code></pre>
        </article>
    </section>




</div>

<nav><h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Client.html"><span style="color: #999">Twilio.Conversations.</span>Client</a><ul style="margin-left: 1em"><li><a href="Invite.html">Invite</a></li></ul></li><li><a href="Conversation.html">Conversation</a><ul style="margin-left: 1em"><li><a href="Participant.html">Participant</a></li></ul></li><li><a href="Media.html">Media</a><ul style="margin-left: 1em"><li><a href="LocalMedia.html"><span style="color: #999">Twilio.Conversations.</span>LocalMedia</a></li><li><a href="Track.html">Track</a><ul style="margin-left: 1em"><li><a href="AudioTrack.html">AudioTrack</a></li><li><a href="VideoTrack.html">VideoTrack</a></li></ul></li></ul></li></ul></nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0-dev</a> on Fri Nov 20 2015 16:47:21 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
